import classNames from "classnames";
import pako from "pako";
import { useEffect, useState } from "react";
import { Gem } from "../../../../common/types";
import { ExileList } from "../../components/ExileList";
import { GemOrder } from "../../components/GemOrder";

const POB_CODE =
  "eNrtfWtz4kjS9ef1r9B2xG70RNtu3ZF6p599MQaDzc0GXz8sIaAA2ULCkgDTE_3f38wqCQRIWNB2u2fGsxszBuqalXlOZlap9Pt_n4YWNyGuZzr21w_CIf-BI3bH6Zp2_-uHy2bhQPvw3__b-71u-INa72hsWvjL_-3943f6N2eRCbG-ftCVD5xvuH3iX4VNSS1oamTY_oA4dsW4d9wTp_v1Q3NAjlzTJmfQzAeubdhd0__6oerY5APXsQzPqxpD8vXDhWH3ifuBM7wOsbu5xQ84kJ5pd_HHoWHaDafzQPwT1xmPvn4QYRgTk0wrTheKlir12kUzMgjTDgZxYrjjh4Fhf4CJ_OP3umXMiNvwDZ_z4F9fP2RBHkafHBtD-De0aFhjaE7XROWQlwRdzgi8In74HF-5MSKkO68kHUo_r2DdJflej3R8c0JyrunnYIqdxQQE_lDXkuruUr4ytnxzZJm4FmGdQyWpRjGmAz6pcNPxDeu43lhMW5RF8VDlFVlUZDnzOvUcf14vcWTXpj84smBFdugF65b6tumTHSrXHdNz7GhFQclowqGs6byiKqL0TMVlbc6IEp851AVJ1hVJljeNeL1jESxA0g4zgq6rPK89J9SlqpKmCuqhIMjQrZo45pwzbANKdHfoNayanfS3FXHWJUatx2zowuiaY2_RuZBUqWLYRs7xUqhO2eyRpZKAI0ll8410bV7AoqYrieOsExfw1E8_3K0qNPwIEChq4pDJ43LJRCEck6fI6osbGoyWFBQ9qWTJXkxDlze0t1RQSh7fxPGB7dLJcl5KzSRPGcC-8wVLl-zOYkYZZVPDl7ZLPOJOIiyxqYvlKsEKpwFlrHhB-mQxXz1zuGFdsHyZkM7gBIj6wvBJOiVdTELPbBQTFo6KaWOrMUKSRQCTdHVWpQQIJmZUnQdpyRIvb2pkWWKCeChuKr2lvK4Nt_t8qbxN3P6sMTCJlaI0lW20SioZRyssTzlVlS3nnZ8YXirDY5NhpZdMSkm06goBeocqXbLir_AvV6PuOvfoqFnbVcu6Q2e8gM6MpiraxpmzCtGJi8ljGsw8swOMTT2FC9Idd5bATU9ejdDrrDgTMgQ7oS4reOGLXg-Tqe7IAh9-RQLSJm_YsuKqJAvN943Ow7HT7aeWM-1k-xqN8WgEiIG6lt7VLZguCNszIwybDPeLwjUIUnLGaIFIGxwitMiUHSwKr3agJcN8f-DbEM-l7mSlxmpPiaICoTreSi8HyaoSKZ66i8LYWoofREHVJF4_zCi6qvGJPk3jwVyu5xtti3zh-CdREHoZPjmQqjtTGNoAg2cvBW5ESleMhc-TKIOCS-xvs9TtLxVP1UHe7o5d1PXUfazWSNVNluILRBRkWDaHZsRfoTV-_0zzEfhXaThyXJ9-mTOsjkfbK9mjsc_ZNIUwNL1Oqz3u9TBN8AHad2myI18o5HPN0lU-GEK0iofL27LHwzbGuuy_Ydf_-L1BKFByHceyjJFHul8_9AzLg7bNbqAaDWCIjp-qPMTJQayWpjQ4AB3XBLGnKYwBbqoh04xDmpKYBkhVEFbFsEh6gTVnI4LL76WVWQC4aUrT8D1VSRb6ppsgjevTLQPpGLNUJedeUarSeYtkTQv5N53UKmAIjLrTlQcidc322E-pbTTmSTUOdPpTTTDqx6a0jnQFA8cq1SAC1zNN2YCr0ikluDSpl-2Y9Aioe0qzp3DSNB6IHYBlCIy_U1vzOA8Q84QMvaMZcFgBxbuSglkqAOzmjqHtLukZYwu_Px8blunPqHcZ-brMssP4pTdwpugesXbQuj2QernMfslaftAEdhIOnk0NR0hTvYwC6Gc6fgRgzrQ71rgL0XJA3POJW0Yb-_6f-O--_x-unL_KlznhQBC5f1v-fz5wfcwY55yxDdximxZmvZGxu-HcVjqMgP2PjSdnjD3f7HBZ13WmOw0DR_GP30FOQdkTy2kblrjoaCH0aAEhbJJyWWkObsFAHpn4SxSe6PrB4MgQP1eIb3QN3_hcAvL1PuMKfaajgb_i2oj2vVDEDpskiAgpFYOTVWF8frGZBYpWNzFq335uczVdaSD9xIKKLz6jK8fsAlqao7FlsNgsbm60Vt1w2ahSzTSx4fRzxia4pTaYwTBdeQnbqY_tjj92yRubzXwUu9rMagNb6FVY9cU1i7lPTYf5RrubTHw7W0ACrc_5Dhf10l5Oh44Nb_C2-nM-NoNsxM4axCaxtWxptZcW6DLBigei_MYMyyjJGXtczrE7TpDDenuihRFFB_RjwL1Ev_Etb4EqcRJ7cYQpE88jbrBnTBYJUO_FSOz5HtLLhLXFhY1x0dZe3lExXMOyiPUaQtnU9jbkDm3MXp7RXdIxMZriPnYd-9_GyPH-43POhLhUhPvcAyEjaN42fntbE852OmPX6MyydhdTHl4WPu3uAISz3sVW53XfmfEXZ0Y8O0Ewt8g1fDJ6W9E2LDqYF6Kd-czYxOLFzUYQJ-0Vwby03IsEEK_L_T9rYnGC-ipypxKrmDbY4crgUq8IG2Wtl-079my9RdrYDy3WSgdb20QgRqfHrQ9xZfiNkdklbh3Cvlfw2LOY5_KhN-RgHyjMcd_WlugmBN3y3RmmaG3azg4LEyeQV_XqRflA0t69-r-CV79sxI3xcOjYpFuHoNs3vOGbO_3vbv4WyckXd-x_fqbyL5SbtIz-mHBHxHDJG_NTznFdx8OmBzCK7kuBEp1gOL_t0WhJPi8euxBvZJhvLPf5IHZ0Cq7Glg1eVdvEyrsEMUH_Ly1ctt_KsdMabyviKpmy0YSD2VHUsY2kl_SKRH4ypxYMzycuO9X2A7Aa20x6GbDqHKvvvbjSnWHip-c6Q65Nes5b7_n8qumfv0za5c-a5Ngwubgsx3tO4QdyCu_B-y7Bu6R9eg_d30P37d2ME5eA7b1w7J6i0fRiChr7SdF70FsQMP-wCFba2X7Wf-vI_SUnPD8zu_tEL-02jL271lL6eQYtcCsHeP--CYo3SUm8sn8WKEzJ7oANe6Qbfd54C3ctlUomdLK1lObtcNgQum4x4wW_pu051hgNtEmGI8twT8fd-SMML6fFBQsGxmHcwH2kZwMsfCCGrQBn9jjbgSb8Nz4sQAe5FBJtq9nrLWwRmM9F9BcPyn-pfNt7muFPHZ3HO9cXxBj9JGp4D93_lKH7TwvKUmW-t7aiF82DvzTbXBDwIzqEKzrZPjcFe-VOXPzs4AFxgef_xY3Y43lvykJ0TDsr5HLtbYJAo0NeK3GUrx6fZCv5n542Yu2FD0oNwNi4A-6nZ4-E18geiS-dPYqMCXsIxCrOtUV7zydteyzxL5xOen7Sr5VN-nnJleQ5xudWXvSYk9mDKYx-5FDTSgupJxdW_CvkAZNnuUMa8FmnXN1REHUL74V72WxNfB_bu6hTfMibdLl1eb1JugYkOyEesHju-rjJfeJ-4pF44U9_JP4ljXmexTseuz9qzcltpZ7uIqk4byPtlIW0D7Qanl-zo1cf_MBDrYltpZ4xNsFNB8TmWDPc4jqGVLNeX-gozOEUrgzDqjiWT-zGgFjW7mmxhHbSYzU0wLEWONbEyz_hAUSOwQEmyLy_bPy3yWszXvR6ARiyic9dHxm2TXbPqCY0k3paYX0uaODPmllNnuFrJFaPCTjwQ9PeEdfnaxfXyhZLF63-SkdQD7ilPTtwKLZ4JMizHLwwkxgjx-bEv8AjQsmL8ZqZSuFX2t3dYGjbbe6GNCv82Bbuz9mtTeNXrWzWvrRBHjmOj359eOEnmGJu7Hp_o-PhyYvwtzkdniyCuMPhKSap_gI76xsmtdhYf6FFFbRfYo97E6vHPlIS_EVvkGu6hHAGM2haRxCCi9vgE-ebvkXwMTs8nyGISy_0wLFLCAioK7PgIsKvH6B_p4u3w6myIAj7kigImX2FlxV9X1YV-EuStH1Z43V9XxK0zL7A81BAzAjKvoo_7kuaJMvwtyjw-zJ8A3VkQYa-fRhq5P0k-Gx4JxyIGKBQvmv6pFvFEQSreHlRpn_8Y-D7I-_L58_T6fRwZPgDp0eeTIscdpzh5xE0AxI4oAt3gB19zsI_R_3S8XFRELLdYt5xJ_fHxYpdOn9st_rDq1ldVd2DSbPXz2ZpR5_Dnn5nLzXxWLfBJyoVHKmsSjqIDYZJV18IbpZdLyiKui4vCoYXP8e1qGlipEU9qaAqSLwSaVEINf1zZMTwAVY-QQXQfXheBf6QM5q2L6lyRvm-SR0ETVX3JUkVA31QRD3QgbXV35cyUIlqkKBrirav8xL8JYoa0yLaI1MiXsfiVImYsjEN00VefSsdKtiC4MhOtQQ6lB0UD3K9QHdGZ9lst1B96NeKjadppfN0xudGk_Hx6Kb0dFayS426mM2e1Ah8_7fRMUkEx6TquEPwf8tGe1uF2_9DEHllX5IVVYIPsiwJKqiHKosLXVzSQqp6QgZbUHhV5wMVFERZEPcFVZRAR0UVlZQ2hYpHVU4SNV7cZ2odUWUYBA-t8pogUYVGlRVBGfVQnalOMgVXFfiT6beoZFSVqTFTdabcVKWZxtNpMe2WRQFGmBFVCbtTAUlVURQCpZc0HOzbK_0ZAOf4oFroVW5zrf7DtHesez3F8IvZWvG4WMuWHmtnx42y9nSn-9lB_oi_Gt-BUeSdiaqe3LrN3rAxzLuNRj_vdXIjH4ykIWT66oN18dRrnZ9Ue3c3JWt6GxhJTT155Dv3ttfwS53jo_Ll17-NwcjKq9uIrme0GEthascsBVVt2Vx4MAxdy2T2w_YRohVR5akNaboUYHdgb4IG5UXauqDKWmBfzKao1jNTYzYF5fZ1SVECyxMVHiwETQ2GyvPMNJghMNtj5pVge8xYmXkGxierwprtMYtktqfoKkyXGZ-iiaHXIgkSiIvZHgWCtzK-Ghjf9NtjRuavtKf-WbXXPNJKrdtWu3hwfax6Q8vgO3n3wnTBGEtjp9Jpyadls-rdZ--m_VypWhrLtezghH9qNMqOPBrI_eLFdDzt3Cidk2vFehh5DbPlOnemXz2wRXGiKmfZo_bl2ZAXG0flq3LxrHGlVtt69sJoWZ2B2pt1Bq3KZTabcQz3YkYZbTCt5P3zr38fQ1UU3EoDb_2ViQ1UPgOGIkmiHBgXU_yIXTKVZ9bIbI6ZG-1PVhRdCkw34qNRy2I-2tyA4vlJ0XRVC4yB4gKDEUUQeCERTBRJEOSQdmVBgW5lFUvOaXcBGQxnBB0qBrAAZaE5mIPAcIEiQAALOlimKGmaGrJsYOkqFKFQo0g8zJ0hEDQPXQVOp8Z4X1-wMgIDxRkKQQwGosAgqZqsxwADQ8q3B4bGjSBcq63zZl0-fTo7bVn9A9cWBdM9mVXA8Bt-uXR3Orq-N_u8CQafy_eQjZ3AsG_Gx-O7W2Jr97pHuguAKdfJ_ZFW5WfFLrBwVu6Yav_pW118Ouudi9VKP_9gPj31bkmpeVkQandnBgBGpXdkH9dzpnzfOG-BK9w5cTOzRj97DeEWAA-5v248zR6s29ZT6zx_PVFuSvc3vF3qfSsA2y8ApI2AMv37gIiqY96OuJ3dMETSlAxGWmCtmxBl_w9VUUCplQyfkeGTIqkClgRthk-ihuYI5VT8TdSRmyVN2IRDzABYM2teAkMjbA8QRABg2dflXWAJR7wGTqqeiWITE0CAfIIGQMAsXgLQCgmcWTxFLugC8EZRRV2JQTHmqCgiAA5KgQEhSALhLPCQ8BsGbSL0D52JIbzJPI6fyZJBHUMgBReEgccy6gWwqmsgSYA2FaCE13Ah8K2mIRZpmTkmyrpK3TMERYZ_DPOisMgDEEMlGBaDUFhwLfCfGCoyyFQVhHUKisztoroSdZagWiZAxQDDE1BRzcyBH36kkQ6D8TdExVs7QMUSDOZaC9ykca_d80616mX2ZpiEji2ZukH9x_bRYz7vE7lmuVXTLVyVG-cHlao9armZ6b3uiC3xoFe0OxX1yM6d-tP8Q_Pu7Krs3ebuW26d9PvjoydZap6Kj50aKXYBFflq9noyDdyzg7vboSwM1APxWPddR4AoaNq9nGWvhNrDkz6QB9Xzy-xR8agvVqVJv3OjaWd3Z7d39-CenZbGfvEU3bOri4tMs1ApPlH37L5VBPfssX5xM3sg-ZGO7lmudFfnrw8oukqTcuuAxlI35eGp8e1A4o9O614Jxkdjrb8N4mqYkLhsEzc14i6D7DKuJmEnIK4oShjAKOJz-KtoEk09ZCikA1iJYMNgjJl4BBYBXyG-ocXW0Zg1FsVkhnmqJCpx0LzuNEoC9sKQh019DaoZoso6zCAaogUoRifOJhwgRSREY2jInEOEW0HAEAsGF3U-A6kyhAfRIvJmEJYowgfAGUF4UDNJCgESGQIBdB3eKTPAvzM8xXcW4y4FwMzz1bAwRT1sOLME8IErGQF4BroMMVcQnkIuQ3iQga4uITwlEFGXFXkO8LIcdXoZVjN4h7WSF6SA-M4ogPIKU0mG9QDZNN9Ok6xIDxSgGeNFAJ6yA8N3VUJ2EGGeAbpTAmTormGvjNR_FXDvUJdXJ3ntrMPnZ9VetzCRMzIF-ft2S8orun8wtafC9ZnXLs2yJdudNK5Orr1MAPaPB9q03MpljtCFnXw7abVkAM-D8WB4xlePAbzvpkelTqF8_thu3p1OlQO51pNz9eHVVVmxTEoC3Zp0JJwbg2whQ0mgca6fXoJbXGrd0QTZfcuZNcGF7tbzlARAcygJAKhfXIQkAKA-lKVWvoYk4JTKdqWWF7KzLMTod2d3A_kh11erd8UjS6gV3AO_WM3I-kX_7n5U6Z04rbbCYvTqfbtZOKl6l12jcWW2e3q2UegD2S1IoHmtT0ezk6ZemLTOe_cTb3xrufWjzqTSpqRASaCX6Z3nH8aDR7-Y_VvE8P8TJ_APV8nWGxz-tdVmGMMWarVvZQb43_hl-rxh1kf0SWHOxecLulwPhvngpeJAQF6AJSEjZhIoMKTH1BSY0YEZIJimtTYRIvP2KcPOFyCIRRC0GOkAlGl6QH5RdmJUF_DLguMiXMby7pFggzLSItgIPHrKQgzkoxEGYx6WFZF43CSghBMNGhhoB2i_SichXFNyYLQQYYSIa89AP2AUCuzBHloEsxlaU6BmJB64DdRhgNEJ_DPhW4yrMI_fKMsxsg8YXqKCw8gMGlL3AxXZlD1iDB1YD3C5vGDmgJMZz4dETAMPDLFic0fUf5BFHZYk4Fi6WRO4GAIoZOB_MI5nnk6QFlqwLCN0RpCMZaPJJcqeMjYTDagEAQJwRrKM0QNviSazmPuAJMvcHMayYkali06TWxl0lqgvE6SWdJbIQjeLMjrjWWojbwUw_cJ4UiheDdRM8wIGOZlUcq2D6UOhfE2Dp6Fl1M6KhRbwh6oCX54Np8agU-u2-oVCkQVLTb_UatcLHdK1GpmT7Pj-OpdTeK3ZrdiGK5zUtXPdH307HhbNvADBjqedPTwdNPpnyGOdwe3ZhUzGut69kpvdu8xSMBfyPA3mrGx2Ov727eTpvn1yO-qcFy5HzbsSDd4Ua6D2tOKVduse1x6sBnBrfXjbUivFabHodEX3Yno8mJUfIYizh8q42qrcnPOVfuW-VSj0Ts68slmhfMxLmbbC5_o3l8rDaPBYf3w8r953M3L55PzufiweN67ylc6309pR-6ZO3Gahne3XH-Ve-epyomeJJXqDh-sJP9Jli8_mJnwRkI1ok5Y8UwZTRcYgrUX5-MjVr856XgmCtAUfl-54qPc6nJzEoD-FvMH-Y8aYhrzzdrePx39wZ5nLWWMkq_TJMxEsDJkqmdIilLPCaDtyWJQj5yTGktVbcZhEM_-bmAyQEAEU_qOv8dlmKpPh6yBNFpCYoGhKQGIM1RJIDPAVisAgkUMZoUXjnHhCC_bwKKEtHQqJpJgihMawPUpoS1RGVyKgMpltoa8wGc5wkXcMiGxBYduRVzxtCbyqhhuoSxEi9VYYJc_Zi9FRQFOUvoIzAizGZcrEiJ7Sikz1kGbbIilA5jlQWmHkBVPGWB2ZLUjJUvJS-Qy2uspeQeRIPRRGPGzHluYAWVAd7IzgYoFQkfGYDYjzfRHKcigBXDUqRZ5tl2TezDvuTe-mseR1Y-RoUGgaV47sdG6UsTCo3ByM-41ibuRPFekge3nZPT2Wp6J_2af7IkQsnmTvT2sL8hoVekPS1y_u_X6rbXSmCs3Y3Z216zm_evDg5Og-R-k690Dq3wq9myuS148q9zeSedPUveNbsTppdZq2yGdvBme8N7AhGKXkdXV2Gd2XaR0JGFxelY5OSwd3Z8bltFfqimWz2nYld0L3ZYZn3iw7a99feh0gm4u2UukdFyuScPRYr_QL3eZEOz9W_axT7-inJb9lPT4-ZJotcpB7eji5Vf1i7f664OqFXvZa6NZE_gnI6v4OgsJs6aJ1XoRgWOnca4WzHqn1sllXPzqoHQSkhaRUPno641dJa_DQumjTjeFvlOTelrio4qcqmMBHP4EKKVrvGMcuqHAbHtwtnHvBAA6cYUHfjzAgChVxTBIDNnzhWC59GLfGfRsDOMZ9MB2cBGXA4BTMpoiOgXSUAamuLAV22KSWxIbr4d0coZP35aJsyNgHV0GNY0Qo-gO8CPVFZY0XqckyBouS45wQKWGEVEjXF9qRxXlUh2zPyJGiRMBdkUiOUlAQj7F0KTsPxNKqSMpBIMc2AdciOZh1GPwxTtODZCnzacLdMHSEGBMy_qf-RkCF1CYUDVYqGsdR_n8rKiTnlArv-NG3_C2Z3E9Y_jOTO7_0l6iwRTe_8oPpYzsmjivaN_7gqV92hH5_HOY1L24U28k-fWs9HYuiXandkrJUv24Mv00fpdKo0luiwqI7oVR4ABRzI120v-EBwtv6I6VCwXTLpbvpeHorPg3PrhpWcEAwM7wujlrT7s1xrZ9_uIfwa0R05cQ5oPlUSoHjWm8oC4UeUC2ff7pqZC4ViOto3HZsffP7ELfxkty8PD7SHh8b1YkexG2WUPsmOdmb_rWgX5j8U_O0dn93enrZF6tAfeYNuRkCNZ71rsaTXPaomT25zN71j86zJ9ns9fnRY_akdErzqX5m1mrdl4fFY5tS39RoXTXsTC7bEOgmW5mekTrp1k6721BhappJTYWpyTWJuOL56PfP-NQB_lF1fEJ_C64uqpezt43mbZldXvS_zN71ABQWlJ4Y9On6mTPmHNuacS4xLPjP2COxNwzhC4jpE1Ku4RKPM-wuftOhj_RgI-7yk4iHXMFxOX9AoF3Ph2mwV1l63D0QJOexB4JobRyE4dLrSOiVVssPNLLnKA739rC5tgMWFozZd2c4ABxuwenAUPFRcjKBKvjrwJgQGCPn0Kd3xrbp09L-wHWmnMFZjo-PgrHcK9eDpg2uR6acRzqO3fUOuWuobXkO542MIR0Wu4oAGHwE1A71cdDQJ2HTcgln2iAZG2QB7eK0cazYpTEagVRZE1Afn_453KsYD4Tzxm4guS57qITr4ANjWGjmcePRPhWy2eNGOO22FRQ25o8yjsJHGaEf5-OUUGGYPlvOXiD-9rjX28dvuw7x5i8UpfKB0Q3gh3C0v4GUSzbXJ_h8jEXF6A2cMawTLU1AIfqDcMVZKaoY8H86MMvsESZSbJmu8wgW38POYRZTOjOckQ3S7hJoAToMtPQqe1HKNku1aiNU02Yx38hHv89lq1wxe5XnjkuFQv4iX21y2UYuXz3OVnO3XL1WqjYb-9xxrcrm2OQKtYuTfJNr1riLfKOez3HQZGVvLy79_oULvp3rztLPXMmFSV6QnkWeQPdND6zU50Bwhs_18bqgQy68mo1K4tToglZSSVCVNvCeNtBBQld0OF98EFMfTN5zhihe4vZngWV8FPh_oSJRkfYNEy8wAXWDvjuu0cMVhnWgduWxAfzGgWFA94ESnAwc-PGYPjkOekf24pI1X-gsYLbUAgER6Lfh7Giz2NESGDAs2AetQr0xqSxADdtGG1QOFQlpj0pxath-cCnqQqqmf7i35ix_mbeEDZDgZ4_449GiJRDV1HFRs6aG2_XmikOv9C9VT0K1oecLcELQnDceoc0NHccfHIYrbAUPXoWiyhkwCLPDZV2EBrQaCo10pcKXy9OvEXnABn1Uf_8jPrQZWNmRO_bH3j7TeHoF78Accm18WTuVLDT0gGuP34Lud0wXekBrqwUrhkYYHVYHgMsDxekMcNpxYHzI3YJgYJ4PaFxQiF1WRfva8AK3j26gpeVKnWnm4lYcNFGUduStwwwk6KIatjcc-3TUecOFiYNiTFEYD6zEvx_Hjv8fNlTajGn3LLNDx2Y79gG7lxC0GNR8aIIed4FtPE7COwvN-SO6XXoRCGsrjJcoShFrxMbL4JIW2-csek8XUlOgP6i3oCVQDqRi2LMhLjg4aYhbzD5CdERUxmFA4zAsNDXacmcuYe8jypISDeUMHWZewHt-EcfxxkXOAROgS94D2UMJFEN_bHZhYPQ-xrnS04sZATbxS-iPiQI1AXTZ_ggkgzPD1lYuFP2NNoHK0HWd0eqvdK0BUF0qY3dss7sgF5BaKGcbZ1wj37yszzEVhoiKy8EoDUZUILX22IR2TSoMhL1gMRnQeyH80JtaQFOD1YEZINmCv-DTJykZUjLK8rEo5SIbTMui5ui4bY8LKIliGH7ZJnZn8BEvgBgRHADKBH7Pj0zLAR_gn7-FCMk6vfTCcYRjA70BI-mNLWt1WHQ4hzhjj4QoTsflu2a_D2pTB--9Z9pd4oaeCWuiwh7UbYyhAzAF1iw6ZdCzCZ31Tby_CVdG_RfD57njYQTsBzOB2XcPuWagl-BY0UHCoo19Z2gg3lAmIGBX2BYbApRiDYXszOgTFHlZyoyno2CJIEJVTVCi9rS8hPtsuVmnU8YrnKDMS4UrzCwNm4fe-sSyEH-HTpctrjgvT8GVOkzsBuyqgVgZSvPIAZjaqyAPgaKhcQWrgIohaKgLYiZsax84kEqJ6qTjEbrq4_l6A86gvlBzE3GMzDxH4P_Yvkn9Vot6GgzDqJ_q-eD5hCqFk55Sxxf6XR9oqBXUB7rFwTbG1mgwdvcpl-9z9I1QnmnRZUaQxYVnDA9uKi6UD6szhJ8M8MdmFJ_BI8IrjphODJzp3Dll-G6MKIRQ59MOVnbOd1_2DrgG6479gMWGxhPXHXmo5OivEQ8KXYzbs0gR9j3zTBBiuZ4Jw2OA-ZHa1pPhghbD2g2Mkfff__6GHQEaDrDchnY6jhXi88fGAC-B_py3wHg-V0DvbGzlyPAMy18erjkcD0FAQxAGlMgOiT-YeWzOsPIOGjBOokCA-3roOYDSkydo3MQrFP7JZReudig4ilCFuWJ-zHAJQPUbysmMhh6oYH3H6f5zjpGlqL9InctsuYx-IkPPBndRK5fzx9wt-JEBhpbiaXLZX5yB9paAisB5nhcDmHOGMC1AbYjZOtRHsWG-y74l1DyEqsFtE-D1MY8Kq5g9s0NVHcVHZ5nE18EogjFhk6HXGwIFRaSlUqXIAIFNbOYUhn5rAGyA58TohiEOdXPZL2C-lECjl1xR5OPasAQQrsAqQlDIXJ5FgIZ-D9qItAxw80FRJJLRZpWkZabmuA0_zGGGDCPWGHpbgTew5ol6C2K9Lt5y1VqTq2QbzfwFxBc3pVyp0fwvjVBKXDN7ludKEJxUb6-zt_8N9aYxAMcEButN0eOdIeb1ompPXSlU14WM4wC1TM2BtcL4HBEWY3eTurFTIwz95swOjXdNxq9ruoswi0JkITBDSBRo-D2AC0Yn0Jrdj3hgwSp1wYE5jINTDHG8SFGIZn0waaA3wz0A8wagxCtSABHtufcDXVKnYIBBQhUcqimWJ2z86AA1apV8s4i-PnoFrtGmk2SuMCxiOCVadnlMEJy5JqATOBwdA_kHlzfr5JnT43DmELMEgCaM4mYxDS67BZGGjDm8MJ3xEUip4DHMp5WazpPZMVm0hoWoB-qMaPBskR70ypxT_A2CKXAqlp1UKsfAhjCoZg4kxeYR-n_mIq6nX7KilFMjCYq24QX4gRMaoahFcEypj8yAnWqBS1kjsmgLxT_JQzS-CLVOyZRYEDq7CC1QmyE6dQWKhjsJwlOmBK6JuIKuM4AvcwpoQqSPoRaNISmBerASoIEw8NLcJQIUhHH7hKm0R-bZKBo29yNpLOoqO1Q7HFihGXom08gCmUGkUHeOkF_nV4Pi_SCUxoMUGHLEPKxgSxkpDKHTwgeEHskThEe4bkGUxXQo-d7RuNo0-qMuzdDsDzBuhrFgcfh6xgFEzgJPGIk2a4MLaWFAuHxHZqRhMWh3Ke1EHbaOwRyy5aqH0Cw1I5ruQeM3uE8iZwzHFvxNPZTwAwWBTwKdZHBxYw3dlCbadxB0mgj1e_O703PFbLU5T-wccDKoXWyKkbUHJUQ5oQQa7UdUU5CJicEfdG2BI4NyWZFGaD0SZ3S7JtY2UJkwH4Y-x8q9aeA3g4TRwxqxHyaGNSbzSeRqlUqtylUA5wHeI3OpOgvkig30PiJMGNw9GksYzqChU98QvfUeRTl0zxG2AxZw7Hk25beglyBRE6ThjOD6PvixGGRwbMod6KxHMnEROmEUuB4doJvNfkNXDE2ZTQcViQIwtuyTIUtRaPwix0d9sUX4v_DKwhDe6W7wz1CVwQ_qAmZSsyOPY5PhEiguvZTuYxdQGxOfGDbRn5kwAkPd59Z-D_R4igGAsdb4vOH4mjWIX0McodnfsFJQuBvURiChsEZj6QFawthj6WEDuRhquewOMM8G3Rw4VJ4fMYH3BNpFpRDEJRMYofMb5u_DvD29PujKpMlodNUbvouHnr85zvD264cDRZYOFVGVeF5SVVH5gCnaaZEYfsUYzS9TwsJldqGSzko0YGTHZq8HAIzp4_CGIyx4A60KqqpDszr8o4kq22r4nV6eFCTg8e8GYZchgb40aNjHbg6kX7OO6ZYEFuVM3ASR2X7aBSC0P_vCXeTLpdwew4TsRfmWm79SgXvJfw736kD2LMimFLV3zu54-sLxeyXgF-Bi38MPuH-Co10etiSsDDt7kQ-SXifoDrLLzPZyhts1EVIu6NZF8G2WxjpfOFHTgr8hLCJ14nbQM7DIF07Yy08M3H5khYIP66VymCQh3S8crhRMifTMpy_cH3SP4Qt_qMuZ7_O77TAa1eZlquDDLn9oAOYt1RZ5eVE7vAm0SqbyvOhSPfphLkWR3wu2oL5wJwfwP5Z0vSCPXzhVXRbxJzEjIFKEfXAXBtrC3idND_CWhog4gb0_fKPvfRnbEwIi6LYw40AsakeGtY9x7D71MPYhZjQR5zrk-x8dJqXvwcyE758-CtKBoPxG4byAvhiaZ466Jhfzih7dSas43Qu6ZUMrs1v-6FmN4PR-jG6Im3WDXcO7V0USH6JHAesKkR58FSqGoMsJisFHFYNPUgw-QTHWF31dZTLCssqo64qR0fTvZRw9xn9MXspOOrGsFZkVrVDXV_-TJNM1m_ceWa7NqoGpia1VI4f5jBdVDWmzatC3t-w1XXM8HOGteFwZvgWydOeqISvq86qhZMSXU40lbdDXtUGXvqMJrepB9HeUY6yebFKNVfXQV9RDV2LUQ1mYdEQzwu_peka-T1gkefMisdv5945do-_YHkRL8JUxtn1wfL2FCcvK8-uEhV5nndasVoiFcml9uWRVWTVu9WXsWVT4WJRX4xZSS7bzhFVTNq8avXp1adHYNz91weZSFmRtFWbDMuHdsFfEckB2s03QutO6KKs4K6zJX1racZvfVtsYgaefJH91s_yzNDLcy_YxSg8-POe-ZMQkIaVwX3T5O7jFxO77g8z815LtA56afXRwVwS7kJAiRiUk7EXJQT0QZbrjFLZN-SHa7N4nWYwWAGWmer9cJobcNlCKEE8pE5C1gbePSgHzZDavwQXaW3PqHDR8TGHSj8-sAa-oP7QGcoQc5PgCC3ZY8Syv2PS-RFw0KLr4ek7Pc5iIqbL4rQHeQMfHbEtYSFoVxkIHpKUwQNr7I5A1aMF88AoqBF1rQV31JZeZxlvUFzfVX59RfCPSksMSP4T4JuKs_ZOox9Nm8P06ba4rKsxmSVU3lBCTSqTwn7RnQJ5Y_h4EupMZ-_NVAUYVk73gpS4SFTyibnoi5IjKgaT8towoca5xwmJ9kqRNVLot5NAFlBJj9krp-NcM2MW4oKxiss2bHbgpI6s_EFor39nN1SyXialRzIwuEqPCIMYzywhasme2KMWjZ7GgGnkvZ0AANPP8qH8QITs5Kj5xbx4SZS3wP0AgHpft9_GMgTmhoSomSbemRFFdp0CB-XhBftiJyQ_vfdIy64qOmeEdFFpMVmhBSlaOz-FRNOYuImE06SEldpf_R-Yzfg68wt8WyR05TQwPhbb0J8uwKFbkvQfYQ9buBq0oMQwuaEmamuxqLpJAohLBr0x8gRWtzOzkl2b4BEW8IME5UsKJ9MAjPVcROVgS7FhO8cxV0fRBH1CK1iyqpdqBID7H0Rk56vUy0dKSgXBBHfkYdZTicVfegLvP-Nfb6vCqHygqG8BuaydwJSGU2Yoj1Sj9iTHhpvhM-kDMJIWub-oean9R91BgOde1ID0Tl4wT491GQfnF3EZR3WAPW_mMK7agbxUM8UJMRDpvGDu_IN1xh3TpmTH2IhQPz6sIO0SqcW7jamCqry8q7va7bBTB0bVcZAdwV4cxs0H-v2g6LX7BtRhfThQiEKe-QiJci7O9eG8_Jgdu0LfJ7HfoMZN9DykmJu_9URIOJMSICAHSigyvcB-aslNw_Ic-TbNZHzbZo7ZBH37FHPh8sTVhZUdNEOMXPBIA6t9zdLu_6eB7gtCTBklallcEBJZbL5cQl4TowYKwL452Fp6a-CSImYQ9NSgMEu2Q_SXtwVMC-0PDNuJ0RjnQljTmBVpF2ktstwI1UqjcBhKRNyilvkEpn9-zk4QU_r6s_JhSbun8r7FVbLY_Lj2xSFRr0qp7L78Iqj3vbOtxSQ413tkWla32BQ32SvM4nRZE4UCQ-SX9C9-2S5-rCN6GvvQAS2pQVDbktvgN-vcrnCdY0SaB38b5kTfCoNhqvfyhAjENHPJxefi45VGTz6lUf9GcV-w-pp0W0N7sEMLzqKVGd88iMaHSWisbG33ujlvCIi0hL8Xwm44qfpIlJTaoikM4QUzt2P2KILZB5f70GKbzWjpXblFDU78HMV0ez9oyhcBHBOnrlKWXwLk0bh8ed6SnRpVIeEdHFKZf6YlsHBQe_8YQ0Xyg6YDU-CgIG5b-eZ9eERPR5lDXF0uvKnry0oOoCRkSl8NRbacI4jaKoOnCloqAR6YWaa5M3I5AAaLybzMWbdfsoumzHkpgnWNMmAs_IziIASRZjs3yREYuLJ1opk8MGhybTpA9wKPKMKO_QKSxGkk8B5IbWlA3bEiIG4wpVcJElFIkTLBQInsXocnNphQfIivffyxKiUmx6IL4nR7BS9ovmxuJ-ArpF5HtN7EzgJt2q1LsH6Q60PpWGZsNwbGwyZdMv32a7PslAK2WSbHlKSpLO54rrBpuf9LDP65pe2bnmS1RWXuBLVHt2S1RcX1LdNPW5h-wfr4z_P6JHuBgr8gAVw6fVGRvJccnlFaxEOEv9pSrLBwoLD2c9gzSc_n3TXCmbNAeurNyRdwhXgKAT7m-6oaUDkQcLkqMKuFxp7jtqCVNitcajU_IxQPJZJLJ65OUWU7Kx-608PEcTBd75ZCzFSpPmoPO6TaWns_67xIrCOoGraBbMWVi0EfT0pzlEXV1570Ztvkyrx3dfjmhT-LEaApmguM2xld2aNbCx6UdGgjR1hdblxKdsNWocDkGXd6vYU9SrekIfUYivY5kDkQ-1c7h6-iIkph1CZ69f7Gky48mW1bCn0r2BEbawCeMDdxUPjYnsByRKyGegzhaaK6SF6SDLscsO8TXzSeeoteimievJFyXdIU1xAXtgp7gMbEwMgx743DsSenyuPlGHu4LHqcNrsgIdDN4aL5IXCDMZwxaYSIojC2YT2cRFimtVmvdgGnZI_i2MQDXjt2fquzFI_XyCegIvy_uBsit3Q0QGBJ9rPF7Du-9IjTX45EOW-ETdj0dMBg0s4e4wWXm7cxvYjCCMyptvJuHy9tkONtTlUhQTkeOgqITCe5N47pj-swqkyIrk7AumXTrErl9LFgUEIlhGa-0KoEHTK8VLOI9BHZfTlqdpITbxtXZSt5LlhAMLUjKLUuabJK0lk7S0VthlgQOAYLRBafHeSWZswDkVxR5EBqlF7WeEmxipFybWq8k3xxexPgM0ry-YGOxgw7N2x48BD6doOmFQu9i3lnMmUS35jR_nS-DW2MMR__hLqul88v8jzg5P-zVxJ3UCG7wY_nJoNkr0zW7JsiLfXzGuQkyTUv-Oqu42U1nPbOOs3Y33NIoOC6rHe8WRVVlZdaZxLhMW9_dmW-h7CnRhGfwY5DiTJBj3OGCGl6dYuBLyTFFGlx0GQgw7rtn7Svbozs5MMKq4-NlBJf21JjQ6y6sWX5iWqkqXQNfkW7dsKxWXJ46ppOBY83oxYIru7hLw2dZii-cMa_fos_jtti9MiuF8WJtcK_GeA4z6tXKq8_lzHMz3a7HaVyd3a_NOvMWP4scFMCVXPqd2nowOpYRXGoQyjeGmGBZqdV36flQ3Kpb6Eg0P7gnxHWHd9gwYbFrGDeVWqwbRxcusShbLQ6XK8lT5zfoXoV0TVD5ZUWL_XJ77asT4-HK7OO9bmmKN0YmzGSxfbohlfucYlEvvdUNzTVZteTUqiUnqlbi0hhLqrWNZqnrYX3AOnMISuwVpc4FYk8sxGQd2atO0p24Xb0gB_4zgZ-WoRYGvwe710mbAWJSLoZfPVeZNq-fSBJLQmvgheHsJpTw6hTbGMLfbAEjF7pngoQHrcHKsE2dyFXu4noZTFJFSqjREsn9Rm6cF9bbZOdAFkXkdI0KkUb5dFUiV-Rr6WpEbraPkQa7WCZaSFovdEFvMIsMVokRq9OdBSFJpKCQ0JjwXGOOH13GmDGxHZJImVDmwf05G-7Omb9LZv7I44fosYsY8QgNvEM02555eLVd8PqAiEqELyuIq7paTUxXbXMp9tjUbgOKm8szg0Kb2bLKmrluGJIYNyRpN_GmE4L4QtXk3Qap7taburs0d9GnZ1aAgd62HcVokrpLP8-o3yoTSHLqlqXdzUjYZSbybsog7KZ68vPrE5GalijabduNU7AdZ54KedYJ-_nx7ICC0nPTnrPilusXL-WdFEzZpVIqo4xoipi4EjtNVNlZruIOiqjuZkvSbvorba9m8u7Iv4NSCzsLX0pjmnKaQjsM-wf8n5QrGdF3YctlUHdQy93X4Qf0JS0oY92UZpO-6A6SWw1OpExqkBF3lu-OgJF-QSPzkVLPR0ohKeEZSW1aCXlneSm7cEAak4nMRtlS0Z8Z02qAKS0dzYJwcstoM3gI6UN03_891PyxUDNVnkh7DzzfA883CzzFzHvguX3gKap_qsBzm7zxexj6imGoqKdcl5jU-3tU-reLSlPts4gpq4hrW1O_VsTKv0esv2bEKip_rYhV1F4rYhWVv1LEKkivG7GK4o9FrMFTJB-iJ_PfI9afELFm3iPW94j1zSJWQXyPWLePWIX3iPU9Yt0hYpXfA9b3gPVlA1Zt-4BV_BUD1vd49deMV4W_WLwqCK8Vrwrv8eoW8aogr8er7G_6ts6cY_fMPoth7dE4bAXfMovHyH20gLbjWMSwA7T7vFYY4136gtoyIR180_bzVQg-ulbyjhwPROHh3Sf9rx8apjv2YgqzN9qyN93ii0DJokqpWoipgKPPWp0BGZqe750Q24R2nx3TcH6snr2Jl3QbeGcNfRwDMH48bBM3cqY8vip74qpm02fzFrUYe_z-ORT375_rhj-o9Y7w7cwwk__b-__AFEFt";

function decodePathOfBuildingCode(code: string) {
  const base64 = code.replace(/_/g, "/").replace(/-/g, "+");
  const base64_bytes = Uint8Array.from(atob(base64), (c) => c.charCodeAt(0));
  const inflated = pako.inflate(base64_bytes);

  const decoder = new TextDecoder();
  const xmlString = decoder.decode(inflated);

  const parser = new DOMParser();
  const xml = parser.parseFromString(xmlString, "application/xml");

  return xml;
}

// https://github.com/PathOfBuildingCommunity/PathOfBuilding/blob/0d3bdf009c8bc9579eb8cffb5548f03c45e57373/src/Export/Scripts/skills.lua#L504
const POB_GEM_ID_REMAP: Record<string, string> = {
  "Metadata/Items/Gems/Smite": "Metadata/Items/Gems/SkillGemSmite",
  "Metadata/Items/Gems/ConsecratedPath":
    "Metadata/Items/Gems/SkillGemConsecratedPath",
  "Metadata/Items/Gems/VaalAncestralWarchief":
    "Metadata/Items/Gems/SkillGemVaalAncestralWarchief",
  "Metadata/Items/Gems/HeraldOfAgony":
    "Metadata/Items/Gems/SkillGemHeraldOfAgony",
  "Metadata/Items/Gems/HeraldOfPurity":
    "Metadata/Items/Gems/SkillGemHeraldOfPurity",
  "Metadata/Items/Gems/ScourgeArrow":
    "Metadata/Items/Gems/SkillGemScourgeArrow",
  "Metadata/Items/Gems/RainOfSpores": "Metadata/Items/Gems/SkillGemToxicRain",
  "Metadata/Items/Gems/SummonRelic": "Metadata/Items/Gems/SkillGemSummonRelic",
};

function getGem(gems: Record<Gem["id"], Gem>, gemId: string) {
  const remap = POB_GEM_ID_REMAP[gemId];
  if (remap) return gems[remap];
  return gems[gemId];
}

export function Gems() {
  const [gems, setGems] = useState<Record<Gem["id"], Gem>>();
  const [gemIds, setGemIds] = useState<Gem["id"][]>();

  useEffect(() => {
    const fn = async () => {
      const gems = await fetch("/data/gems.json").then((x) => x.json());
      setGems(gems);

      const doc = decodePathOfBuildingCode(POB_CODE);
      const pobGems = Array.from(doc.getElementsByTagName("Gem"));

      const distinctGemIds = pobGems
        .map((x) => x.attributes.getNamedItem("gemId")!.value)
        .filter((v, i, a) => a.indexOf(v) === i);

      setGemIds(distinctGemIds);
    };

    fn();
  }, []);

  return (
    <ExileList
      header="Gems"
      items={
        gemIds && gems && gemIds.map((x) => <GemOrder gem={getGem(gems, x)} />)
      }
    />
  );
}
